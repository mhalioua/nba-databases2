<div class="header">
  <h1><%= @head %></h1>
</div>

<ul>
  <li><%= link_to 'Back', { action: 'game', id: @date_id }%></li>
</ul>

<p id="name"> <p>
<table border="1">
  	<thead>
  		<tr>
	  		<th><%= @game.away_team %> <br> Starters</th>
	      <th>POS</th>
        <th>MIN</th>
	      <th>PLAYER <br> POSS %</th>
        <th>PRO RATE</th>
	  		<th>ORTG</th>
        <th></th>
        <th>DRTG</th>
        <th></th>
	    </tr>
  	</thead>
  	<tbody>
    <% @away_players.each_with_index do |player, index| %>
      <tr class="lists list<%= player.id %>">
        <td><%= player.player_name %></td>
        <td><%= player.position %></td>
        <%
          count = 1
          if player.possession
            count = player.possession.scan(/,/).count + 1
          end
        %>
        <td><%= player.sum_mins/count %></td>
        <% if player.sum_poss && player.team_poss && player.team_poss != 0 %>
        <td><%= '%.2f' % (100 * player.sum_poss.to_f/player.team_poss) %>%</td>
        <% else %>
        <td></td>
        <% end %>
        <td><%= '%.2f' % player.prorate %>%</td>
        <td><%= player.ortg %></td>
        <td></td>
        <td><%= player.drtg %></td>
        <td></td>
      </tr>
      <% if index == 4 %>
      <tr style="background: grey">
        <td>BENCH</td>
        <td colspan="8"></td>
      </tr>
      <% end %>
    <% end %>
      <tr style="background: grey">
        <td colspan="9"></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td><%= @away_total_min %></td>
        <td><%= '%.2f' % @away_total_poss %>%</td>
        <td>100%</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
  	</tbody>
</table>

<table border="1">
    <thead>
      <tr>
        <th><%= @game.home_team %> <br> Starters</th>
        <th>POS</th>
        <th>MIN</th>
        <th>PLAYER <br> POSS %</th>
        <th>PRO RATE</th>
        <th>ORTG</th>
        <th></th>
        <th>DRTG</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    <% @home_players.each_with_index do |player, index| %>
      <tr class="lists list<%= player.id %>">
        <td><%= player.player_name %></td>
        <td><%= player.position %></td>
        <%
          count = 1
          if player.possession
            count = player.possession.scan(/,/).count + 1
          end
        %>
        <td><%= player.sum_mins/count %></td>
        <% if player.sum_poss && player.team_poss && player.team_poss != 0 %>
        <td><%= '%.2f' % (100 * player.sum_poss.to_f/player.team_poss) %>%</td>
        <% else %>
        <td></td>
        <% end %>
        <td><%= '%.2f' % player.prorate %>%</td>
        <td><%= player.ortg %></td>
        <td></td>
        <td><%= player.drtg %></td>
        <td></td>
      </tr>
      <% if index == 4 %>
      <tr style="background: grey">
        <td>BENCH</td>
        <td colspan="8"></td>
      </tr>
      <% end %>
    <% end %>
      <tr style="background: grey">
        <td colspan="9"></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td><%= @home_total_min %></td>
        <td><%= '%.2f' % @home_total_poss %>%</td>
        <td>100%</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
    </tbody>
</table>
<% @home_players.each_with_index do |player, index| %>
<div style="display:none" class="boxes box<%= player.id %>">
<p> <%= player.player_name %> </p>
  <table border="1">
      <thead>
        <tr>
          <th>GameID</th>
          <th>MIN</th>
          <th>FGA</th>
          <th>FTA</th>
          <th>TO</th>
          <th>OR</th>
          <th>POSS</th>
        </tr>
      </thead>
      <tbody>
     
        <%
          game_list = player.possession.split(/,/)
          game_list.each do |game_id|
            game = Nba.where(id: game_id).first
            search_player = game.players.where(player_name: player.player_name).first
        %>
        <tr>
          <td><%= game.id %></td>
          <td><%= search_player.mins %></td>
          <td><%= search_player.fga %></td>
          <td><%= search_player.fta %></td>
          <td><%= search_player.toValue %></td>
          <td><%= search_player.orValue %></td>
          <td><%= search_player.poss %></td>
        </tr>
        <% end %>
      </tbody>
  </table>
</div>
<% end %>
<script>
$(".lists").hover(function() {
  $(".boxes").css("display", "none");
  $(".box" + $(this)[0].className.substr(10)).css("display", "block");
});
</script>